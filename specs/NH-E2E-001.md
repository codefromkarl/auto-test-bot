# Spec: NH-E2E-001 é—¹æµ·å®Œæ•´åˆ›ä½œæµç¨‹ç«¯åˆ°ç«¯æµ‹è¯•
Issue: #12

## ğŸ¯ Purpose
éªŒè¯é—¹æµ·ä»åˆ›æ„åˆ°æˆå“è§†é¢‘çš„å®Œæ•´åˆ›ä½œæµç¨‹çš„é›†æˆæ€§å’Œç¨³å®šæ€§ï¼Œç¡®ä¿å„ç¯èŠ‚è¡”æ¥é¡ºç•…ï¼Œç”¨æˆ·ä½“éªŒå®Œæ•´ã€‚è¦†ç›–ä»å‰§æœ¬åˆ›å»ºã€èµ„æºç”Ÿäº§ã€åˆ†é•œåˆ¶ä½œåˆ°æœ€ç»ˆè§†é¢‘å¯¼å‡ºçš„å…¨é“¾è·¯ã€‚

## ğŸ”­ Scope
- **é€‚ç”¨**ï¼šå®Œæ•´åˆ›ä½œæµç¨‹éªŒè¯ã€å¤šç¯èŠ‚é›†æˆæµ‹è¯•ã€ç«¯åˆ°ç«¯ç”¨æˆ·åœºæ™¯
- **æ ¸å¿ƒæµç¨‹**ï¼šå¯¹åº” `docs/é—¹æµ·å…³é”®æµç¨‹.md` ä¸­çš„ 7 ä¸ªå…³é”®æ­¥éª¤
- **åŒ…å«**ï¼š
  1. æ–°å»ºå‰§æœ¬ä¸å¤§çº²ï¼ˆPhase 1ï¼‰
  2. å»ºç«‹åˆ†é›†/è§’è‰²/åœºæ™¯ï¼ˆPhase 2ï¼‰
  3. åˆ†é•œåˆ†æä¸åˆ¶ä½œï¼ˆPhase 3ï¼‰
  4. èµ„æºç»‘å®šï¼ˆPhase 4ï¼‰
  5. èå›¾ç”Ÿæˆï¼ˆPhase 5ï¼‰
  6. è§†é¢‘åˆ¶ä½œï¼ˆPhase 6ï¼‰
  7. å¯¼å‡ºäºŒåˆ›ï¼ˆPhase 7ï¼‰
- **ä¸é€‚ç”¨**ï¼šå•ä¸ªåŠŸèƒ½æ¨¡å—çš„è¯¦ç»†æµ‹è¯•ï¼ˆç”±å¯¹åº” NH-*-* spec è¦†ç›–ï¼‰

## ğŸ”Œ Preconditions & Gates
- **Env**: æ ¸å¿ƒæœåŠ¡å¥åº·ï¼ˆPort 9020ï¼‰ï¼Œç”¨æˆ·å·²ç™»å½•ä¸” Token æœ‰æ•ˆ
- **System**: å„ç‹¬ç«‹æ¨¡å—åŠŸèƒ½å·²éªŒè¯ï¼ˆNH-CREATE-001 åˆ° NH-EXPORT-001 å…¨éƒ¨é€šè¿‡ï¼‰
- **Config**: ä½¿ç”¨ `config/e2e_config.yaml` æˆ–å¯¹åº”ç¯å¢ƒé…ç½®
- **Account**: æµ‹è¯•è´¦å·å…·æœ‰å®Œæ•´åˆ›ä½œæƒé™
- **Storage**: å­˜å‚¨ç©ºé—´å……è¶³ï¼ˆâ‰¥5GBï¼‰

**Gates**:
1. **Gate-Env**: ç«¯åˆ°ç«¯ç¯å¢ƒå¥åº·æ£€æŸ¥ï¼ˆCore services healthyï¼‰
2. **Gate-Run**: æ‰§è¡Œå®Œæ•´åˆ›ä½œæµç¨‹ï¼ˆ7ä¸ªPhaseå…¨éƒ¨å®Œæˆï¼‰
3. **Gate-Data**: å…¨æµç¨‹æ•°æ®å®Œæ•´æ€§å’Œä¸€è‡´æ€§éªŒè¯

## âœ… Acceptance Criteria
- **æµç¨‹å®Œæ•´æ€§**: 7ä¸ªå…³é”®æ­¥éª¤å…¨éƒ¨æ‰§è¡ŒæˆåŠŸï¼Œæ— é˜»å¡é”™è¯¯
- **äº§ç‰©è´¨é‡**: æœ€ç»ˆäº§å‡ºå¯æ’­æ”¾çš„è§†é¢‘æ–‡ä»¶å’Œå®Œæ•´èµ„æºåŒ…
- **æ€§èƒ½è¾¾æ ‡**: ç«¯åˆ°ç«¯æ€»è€—æ—¶ â‰¤ 15åˆ†é’Ÿï¼Œå„é˜¶æ®µè€—æ—¶åœ¨é¢„æœŸèŒƒå›´å†…
- **ç¨³å®šæ€§**: é‡è¯•æˆåŠŸç‡ â‰¥ 90%ï¼Œé”™è¯¯æ¢å¤æœºåˆ¶æœ‰æ•ˆ
- **äº§ç‰©å®Œæ•´**: å¿…é¡»ç”Ÿæˆ `report.html`ã€`logs.txt` å’Œå…³é”®é˜¶æ®µæˆªå›¾

## ğŸ—ºï¸ Mapping
- **Workflows**:
  - **å®Œæ•´æµç¨‹æµ‹è¯•**:
    - `workflows/e2e/naohai_E2E_GoldenPath.yaml` (é»„é‡‘è·¯å¾„ç«¯åˆ°ç«¯)
  - **å¿«é€Ÿå†’çƒŸæµ‹è¯•**:
    - `workflows/at/naohai_05_create_story_to_video_e2e.yaml` (å¿«é€Ÿåˆ›å»ºåˆ°è§†é¢‘)
- **Robot Tags**: `@e2e`, `@golden_path`, `@integration`
- **Command**: 
  ```bash
  # æ‰§è¡Œå®Œæ•´ç«¯åˆ°ç«¯æµ‹è¯•
  python src/main_workflow.py --spec NH-E2E-001 --mode full
  
  # æ‰§è¡Œå¿«é€Ÿå†’çƒŸ
  python src/main_workflow.py --spec NH-E2E-001 --mode smoke
  ```

### è¯¦ç»† Workflow æ˜ å°„
| Phase | æµ‹è¯•å†…å®¹ | å…³é”® Steps | éªŒè¯ç‚¹ |
|-------|---------|------------|--------|
| 1 | åˆ›å»ºå‰§æœ¬åŸºç¡€ä¿¡æ¯ | Phase 1: create_script_and_outline | å‰§æœ¬åˆ›å»ºæˆåŠŸã€ä¿¡æ¯å®Œæ•´ |
| 2 | å»ºç«‹åˆ†é›†è§’è‰²åœºæ™¯ | Phase 2: setup_episode_assets | èµ„äº§åˆ›å»ºå®Œæˆã€çŠ¶æ€å¯ç”¨ |
| 3 | åˆ†æå‰§æœ¬ç”Ÿæˆåˆ†é•œ | Phase 3: analyze_and_create_storyboard | AIåˆ†æå®Œæˆã€åˆ†é•œç”Ÿæˆ |
| 4 | ç»‘å®šåˆ†é•œèµ„æº | Phase 4: bind_storyboard_assets | èµ„æºç»‘å®šæ­£ç¡®ã€å…³ç³»å‡†ç¡® |
| 5 | èåˆç”Ÿå›¾ç´ æ | Phase 5: generate_image_assets | å›¾ç‰‡ç”ŸæˆæˆåŠŸã€è´¨é‡åˆæ ¼ |
| 6 | å›¾ç”Ÿè§†é¢‘åˆ¶ä½œ | Phase 6: generate_video_segments | è§†é¢‘ç‰‡æ®µç”Ÿæˆã€æ’­æ”¾æ­£å¸¸ |
| 7 | å¯¼å‡ºèµ„æºäºŒåˆ› | Phase 7: export_final_video | å¯¼å‡ºå®Œæˆã€æ–‡ä»¶å®Œæ•´ |

## ğŸ§¾ Evidence Policy
- **Runs Directory**: `runs/YYYY-MM-DD/`
- **File Naming**: `NH-E2E-001-run.md`
- **Required Content**:
  - Execution Command & Commit SHA
  - Phase-by-phase Results (Pass/Fail with timing)
  - Critical Screenshots for each phase
  - Generated Assets Quality Screenshots
  - Standard Output/Error Logs
  - Link to HTML Report
  - Performance Metrics (å„é˜¶æ®µè€—æ—¶)

## ğŸ“ ChangeLog
- 2025-12-21: æ ‡å‡†åŒ–æ›´æ–° - å¯¹é½ NH-CREATE-001 æ ¼å¼ï¼Œç»†åŒ–Phaseæ˜ å°„
- 2025-12-20: æµç¨‹æ›´æ–° - å¯¹é½ `docs/é—¹æµ·å…³é”®æµç¨‹.md`ï¼Œç»†åŒ–7æ­¥æµç¨‹ç»†èŠ‚
- 2025-03-08: åˆç‰ˆ - åŸºäºæ—©æœŸè®¾è®¡æ–‡æ¡£åˆ›å»º
