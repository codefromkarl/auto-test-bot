# 闹海测试用例管理文档

更新时间：2025-12-16
文档版本：v1.0

## 1. 文档导航

### 1.1 快速索引

| 文档 | 描述 | 位置 |
|------|------|------|
| [测试架构与用例生成指南](./测试架构与用例生成指南.md) | 核心规范 | 定义测试架构 |
| [测试用例目录整理](./闹海测试用例目录整理.md) | 用例规划 | 目录结构和分类 |
| [前置用例复用分析报告](./前置用例复用分析报告.md) | 复用机制 | 共享前置步骤 |
| [目录优化总结报告](./目录优化总结报告.md) | 最新状态 | 优化成果汇总 |
| [文档整理计划](./文档整理计划.md) | 历史记录 | 文档变更历史 |

### 1.2 历史文档

所有历史文档已归档至 `docs/archive/`：
- `测试用例拆分方案.md` - 已实现的拆分方案
- `测试用例格式修正总结.md` - 已完成的格式修正
- `闹海当前版本-测试用例文档-更新版.md` - 旧版用例文档

## 2. 测试用例执行

### 2.1 快速开始

```bash
# 运行冒烟测试
python scripts/run_workflows.py --type AT

# 运行功能测试
python scripts/run_workflows.py --type FC

# 查看测试报告
ls test_reports/
```

### 2.2 目录结构

```
workflows/
├── shared/           # 共享前置步骤
├── at/              # 冒烟用例（3个）
├── fc/              # 功能用例（60个，FC-NH-002~060）
├── rt/              # 回归用例（待补充）
└── archive/          # 历史文档
```

### 2.3 命名规范

| 类型 | 前缀 | 编号范围 | 示例 |
|------|--------|----------|--------|
| AT | AT-NH | 001~003 | AT-NH-001_story_list_smoke.yaml |
| FC | FC-NH | 002~060 | FC-NH-051_nav_items.yaml |
| RT | RT-NH | 101~199 | RT-NH-001_complete_flow.yaml |

## 3. 维护指南

### 3.1 新增用例

1. **确定类型**
   - 冒烟验证 → AT
   - 功能点验证 → FC
   - 端到端场景 → RT

2. **创建文件**
   ```bash
   # FC用例
   cp scripts/templates/fc_template.yaml workflows/fc/FC-NH_XXX.yaml

   # AT用例
   cp scripts/templates/at_template.yaml workflows/at/AT-NH-XXX.yaml
   ```

3. **更新内容**
   ```bash
   python scripts/batch_update_workflows.py --type FC
   ```

### 3.2 修改用例

1. **定位用例**
   ```bash
   # 按编号查找
   ls workflows/fc/FC-NH_053.yaml

   # 按功能查找
   grep -r "导航" workflows/fc/
   ```

2. **更新选择器**
   - 优先使用：`[data-testid='xxx']`
   - 备选：`[role='button'][aria-label='xxx']`
   - 避免：`text=xxx`（文案易变）

### 3.3 批量操作

```bash
# 批量标准化
python scripts/batch_update_workflows.py --type ALL

# 批量重命名
python scripts/rename_workflows.py --pattern "old_*" --replace "new_*"
```

## 4. 故障排查

### 4.1 常见问题

| 问题 | 原因 | 解决方案 |
|------|--------|----------|
| 找不到元素 | 选择器变更 | 检查页面DOM，更新选择器 |
| 超时失败 | 网络慢/元素加载慢 | 增加timeout或添加等待条件 |
| 登录失败 | Session过期 | 更新auth_state.json |

### 4.2 调试技巧

```yaml
# 添加调试步骤
- action: "screenshot"
  name: "before_action"

# 添加暂停
- action: "sleep"
  seconds: 2

# 检查元素
- action: "evaluate"
  script: "document.querySelector('xxx')"
```

## 5. 最佳实践

### 5.1 选择器策略

1. **稳定性优先级**
   ```
   1. [data-testid='xxx']      # 最稳定
   2. [role='button']...       # 语义化
   3. .class-name             # CSS类（谨慎使用）
   4. text=xxx               # 最后选择
   ```

2. **多候选方案**
   ```yaml
   # 当前不支持，未来版本
   selectors:
     - "[data-testid='submit']"
     - "[role='button']"
     - "text=提交"
   ```

### 5.2 复用策略

1. **前置步骤**
   - 使用 `workflows/shared/` 中的公共模板
   - 避免每个用例重复相同的初始化代码

2. **测试数据**
   - 使用临时数据，测试后清理
   - 避免依赖共享数据

### 5.3 维护策略

1. **版本管理**
   - 重大变更前备份
   - 使用语义化版本号（v1.0.0）
   - 记录变更日志

2. **监控告警**
   - 失败率 > 20% 时告警
   - 连续失败 > 5次时阻断
   - 每日生成健康报告

## 6. 联系方式

- **技术问题**：查看 [故障排查](#故障排查)
- **需求变更**：更新功能清单Excel
- **架构讨论**：参考 [测试架构](测试架构与用例生成指南.md)

---

> 本文档是闹海测试用例的**管理中心**，所有用例相关操作都应参考本指南。