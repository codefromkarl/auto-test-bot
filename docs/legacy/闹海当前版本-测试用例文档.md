# 闹海当前版本测试用例文档（功能清单覆盖）

更新时间：2025-12-16  
范围来源：`docs/闹海当前版本功能清单及流程xlsx.xlsx`（Sheet：`功能清单`）  
自动化载体：`workflows/at/*.yaml` + `workflows/fc/*.yaml`

## 0. 目的与范围

本文件将“功能清单”落为**可执行/可验收的测试用例**，并明确：

- 每个功能点对应的测试目标、前置条件、步骤与预期结果
- 已落地的自动化用例（workflow）与其覆盖范围
- 未落地/受阻用例的原因（例如：缺少稳定入口、需要测试数据、清单缺口）

说明：
- 本文档优先覆盖 **闹海当前版本（剧本/分集/分镜/视频创作）** 的功能清单。
- 自动化分两层：
  - **只读（A类）**：不创建/不删除业务数据，仅做页面到达 + 关键锚点断言 + 截图。
  - **写入（B类）**：会创建/编辑/删除数据，需在专用测试账号与隔离环境运行（本文档仅标注，后续再补齐）。

## 1. 测试环境与前置

- 目标站点：由 `config/config.yaml` 的 `test.url` 指定（当前为 `http://<NOWHI_HOST>/nowhi/index.html#/home/dashboard`）
- 登录态：
  - `scripts/auth/auth_state_real.json`（Playwright storage_state）
  - `scripts/auth/auth_session.json`（sessionStorage token/user_info）
  - 配置位置：`config/config.yaml:93`
- 执行入口：
  - `./venv/bin/python scripts/run_workflow_test.py --workflow <yaml> --config config/config.yaml`
  - 产物目录：`test_reports/<workflow_name>_*`、`screenshots/naohai/*.png`

## 2. 用例编号规范

- 自动化工作流用例：`AT-NH-###`（映射到一个 `workflows/at/*.yaml`）
- 功能清单覆盖用例：`FC-NH-###`（映射到 xlsx 的行号：例如 `FC-NH-004` 对应第 4 行）

覆盖等级（用于描述“只读用例”对功能点的覆盖深度）：
- `L0`：到达页面/模块（路由可达、核心容器存在）
- `L1`：存在性断言（关键按钮/输入/选项存在）
- `L2`：交互断言（点击/输入/切换产生可见变化，但不落库）
- `L3`：端到端（会触发创建/编辑/删除或真实生成能力，通常会落库/消耗资源）

## 3. 已落地自动化用例（AT-NH-001 ~ AT-NH-003）

> 说明：`AT-NH-002` 为写入型冒烟（会输入/可能产生数据），其余默认按“只读/弱交互”设计。

| 用例ID | workflow | 类型 | 覆盖等级 | 目标/断言摘要 |
|---|---|---|---|---|
| AT-NH-001 | `workflows/at/naohai_01_story_list_smoke.yaml` | 冒烟 | L0+L1 | 访问站点→已登录→进入 AI创作/剧本列表→截图 |
| AT-NH-002 | `workflows/at/naohai_02_create_story_smoke.yaml` | 冒烟（写入） | L2+L3 | 打开新建剧本弹窗→填写基础信息→进入“画风”步骤→截图 |
| AT-NH-003 | `workflows/at/naohai_03_storyboard_smoke.yaml` | 冒烟 | L0+L1 | 进入分镜管理页→截图 |

说明：原先 AT-NH-004 ~ AT-NH-013 的“只读/存在性”检查已统一迁移到 FC 目录，编号为 `FC-NH-051 ~ FC-NH-060`（见 `workflows/fc/FC_INDEX.md`）。

### 3.1 执行与验收标准（自动化）

- 每条 workflow 必须满足：
  - `report.json` 中 `summary.overall_success == true`
  - 对应截图落在 `screenshots/naohai/`（便于 UI 证据回溯）
- 报告路径规则：
  - `test_reports/<workflow_name>_YYYYMMDD_HHMMSS/report.json`
  - `test_reports/<workflow_name>_YYYYMMDD_HHMMSS/report.html`

## 4. 功能清单覆盖用例（FC-NH-002 ~ FC-NH-060）

说明：
- FC 用例目录：`workflows/fc/`
- 用例索引：`workflows/fc/FC_INDEX.md`

> 说明：
> - 本章节“步骤/预期”来自功能清单与流程整理，**未覆盖部分会明确标注“未自动化/原因”**。
> - Step 2~6 的用例普遍依赖“已有剧本/分集/分镜”等测试数据；若环境为空数据，这些用例仅能作为验收脚本/待自动化清单。

### Step 1：剧本列表（FC-NH-002 ~ FC-NH-012）

#### FC-NH-002（1.1.1 剧本卡片展示）
- 功能点：剧本卡片展示（封面/标题/关键数值徽章/进度信息位）
- 前置条件（假设）：已登录；进入 AI创作/剧本列表；列表存在至少 1 个剧本卡片
- 操作步骤：进入剧本列表 → 观察卡片区域
- 预期结果：卡片展示封面/标题/关键信息位
- 自动化覆盖：暂无（环境可能无数据）；可用 FC-NH-052 做页面到达（L0）

#### FC-NH-003（1.1.2 剧本卡片菜单操作）
- 功能点：查看/项目说明/编辑(预留)/删除(二次确认)
- 前置条件（假设）：同 FC-NH-002；且卡片存在菜单入口
- 操作步骤：打开卡片菜单 → 逐项触发（查看/项目说明/删除）
- 预期结果：查看/说明可打开；删除需二次确认
- 自动化覆盖：暂无（需要至少 1 个可操作的剧本数据）

#### FC-NH-004（1.2.1 打开新建弹窗）
- 功能点：+ 新建剧本弹窗可打开
- 前置条件：已登录；进入 AI创作/剧本列表
- 操作步骤：点击 `div.list-item.add-item` 入口 → 等待“基础信息”
- 预期结果：新建弹窗出现且默认处于“基础信息”
- 自动化覆盖：FC-NH-055（L2）、FC-NH-060（L2）、FC-NH-054（入口存在 L1）

#### FC-NH-005（1.2.2 填写剧本名称）
- 功能点：名称输入框
- 前置条件：已打开新建弹窗
- 操作步骤：定位名称输入框 → 输入文本
- 预期结果：可输入并保存于表单状态
- 自动化覆盖：FC-NH-056（存在性 L1）；AT-NH-002（交互/写入 L2+L3）

#### FC-NH-006（1.2.3 编写项目说明/大纲）
- 功能点：描述/大纲文本域
- 前置条件：已打开新建弹窗
- 操作步骤：定位 textarea → 输入文本
- 预期结果：可输入并保存于表单状态
- 自动化覆盖：FC-NH-056（存在性 L1）；AT-NH-002（交互/写入 L2+L3）

#### FC-NH-007（1.2.4 上传封面）
- 功能点：封面上传（格式/大小限制）
- 前置条件：已打开新建弹窗
- 操作步骤：选择图片文件上传 → 观察预览与校验提示
- 预期结果：合法格式可预览；非法格式/超限给出提示
- 自动化覆盖：FC-NH-057（input 存在 L1）；AT-NH-002（上传 L2+L3，未覆盖“校验提示”）

#### FC-NH-008（1.2.5 选择画幅比例）
- 功能点：画幅比例选项（3:4/16:9/1:1等）
- 前置条件：已打开新建弹窗
- 操作步骤：点击比例选项 → 观察选中态变化
- 预期结果：选中态可见且表单值更新
- 自动化覆盖：FC-NH-058（选项存在 L1）；AT-NH-002（选择 16:9 L2+L3）

#### FC-NH-009（1.2.6 下一步进入画风与预览）
- 功能点：下一步按钮
- 前置条件：表单满足必填项（假设）
- 操作步骤：点击“下一步”
- 预期结果：进入“画风”步骤
- 自动化覆盖：FC-NH-059（按钮存在 L1）；AT-NH-002（点击下一步进入画风 L2+L3）

#### FC-NH-010（1.3.1 选择画风）
- 功能点：风格卡片列表可选
- 前置条件：已进入“画风与预览”步骤
- 操作步骤：选择任意画风 → 观察选中态/预览
- 预期结果：画风可选且状态可见
- 自动化覆盖：AT-NH-002（到达画风步骤，未覆盖“选择”）

#### FC-NH-011（1.3.2 预览效果区）
- 功能点：预览卡片/推荐位展示
- 前置条件：已进入“画风与预览”步骤
- 操作步骤：观察预览区；切换画风观察变化（假设）
- 预期结果：预览区可见，切换画风后预览有变化或明确提示
- 自动化覆盖：AT-NH-002（到达画风步骤并截图，未覆盖“变化”）

#### FC-NH-012（1.3.3 提交创建）
- 功能点：创建剧本
- 前置条件：已完成基础信息与画风选择（假设）
- 操作步骤：点击“创建剧本/创建”按钮
- 预期结果：创建成功；返回列表出现新卡片或进入详情页（以实际为准）
- 自动化覆盖：暂无（写入型端到端待补齐）

### Step 2：新增分集 + 角色和场景（FC-NH-013 ~ FC-NH-025）

> 说明：以下用例均依赖“已存在剧本且可进入剧本详情/分集页”的入口与稳定选择器；当前仅生成验收用例条目，自动化待补齐。

#### FC-NH-013（2.1.1 新增分集入口）
- 功能点：新增分集入口可见
- 前置条件（假设）：已进入某剧本的分集管理视图
- 操作步骤：查找“添加片段/新增片段”按钮
- 预期结果：入口可见且可点击
- 自动化覆盖：暂无

#### FC-NH-014（2.1.2 新增分集字段）
- 功能点：分集名称 + 分集说明字段
- 前置条件（假设）：已打开新增分集弹窗/表单
- 操作步骤：检查字段存在；输入示例文本
- 预期结果：字段可输入并校验必填
- 自动化覆盖：暂无

#### FC-NH-015（2.1.3 新增分集提交）
- 功能点：确认/保存新增分集
- 前置条件（假设）：字段已填写
- 操作步骤：点击保存
- 预期结果：分集新增成功并出现在列表
- 自动化覆盖：暂无

#### FC-NH-016（2.1.4 分集卡片菜单）
- 功能点：片段说明/统计数据/删除片段
- 前置条件（假设）：列表存在至少 1 个分集卡片
- 操作步骤：打开菜单并触发各项
- 预期结果：说明/统计弹窗可打开；删除需二次确认
- 自动化覆盖：暂无

#### FC-NH-017（2.1.5 分集统计弹窗）
- 功能点：图片数量/视频数量/消耗积分
- 前置条件（假设）：可打开统计弹窗
- 操作步骤：打开统计弹窗
- 预期结果：展示三项统计字段
- 自动化覆盖：暂无

#### FC-NH-018（2.2.1 角色创建方式单选）
- 功能点：模型生成 vs 自己上传图片（单选互斥）
- 前置条件（假设）：进入角色资产创建区
- 操作步骤：分别选择两种方式
- 预期结果：互斥生效；对应表单项切换
- 自动化覆盖：暂无

#### FC-NH-019（2.2.2 角色模型选择）
- 功能点：角色模型可选
- 前置条件（假设）：创建方式为“模型生成”
- 操作步骤：打开模型下拉/列表并选择
- 预期结果：模型值更新
- 自动化覆盖：暂无

#### FC-NH-020（2.2.3 角色卡片展示）
- 功能点：预生成/已出演等信息位
- 前置条件（假设）：存在角色资产卡片
- 操作步骤：观察卡片展示
- 预期结果：信息位与状态正确
- 自动化覆盖：暂无

#### FC-NH-021（2.2.4 删除角色）
- 功能点：删除二次确认且不可恢复
- 前置条件（假设）：存在可删除角色
- 操作步骤：点击删除 → 确认/取消
- 预期结果：提示不可恢复；确认后角色消失
- 自动化覆盖：暂无

#### FC-NH-022（2.3.1 场景创建方式单选）
- 功能点：模型生成 vs 自己上传图片（单选互斥）
- 前置条件（假设）：进入场景资产创建区
- 操作步骤：分别选择两种方式
- 预期结果：互斥生效；对应表单项切换
- 自动化覆盖：暂无

#### FC-NH-023（2.3.2 场景模型选择）
- 功能点：场景模型可选
- 前置条件（假设）：创建方式为“模型生成”
- 操作步骤：选择模型
- 预期结果：模型值更新
- 自动化覆盖：暂无

#### FC-NH-024（2.3.3 场景卡片展示）
- 功能点：场景名称等信息位展示
- 前置条件（假设）：存在场景资产卡片
- 操作步骤：观察卡片展示
- 预期结果：名称等信息正确
- 自动化覆盖：暂无

#### FC-NH-025（2.3.4 删除场景）
- 功能点：删除二次确认且不可恢复
- 前置条件（假设）：存在可删除场景
- 操作步骤：删除 → 确认/取消
- 预期结果：不可恢复提示；确认后场景消失
- 自动化覆盖：暂无

### Step 3：分镜管理（FC-NH-026 ~ FC-NH-036）

> 说明：当前环境可能无可用“剧本/分集/分镜”数据；本节用例先以验收条目形式列出，自动化需在“具备数据”的环境补齐。

#### FC-NH-026（3.1.1 新增分镜）
- 功能点：+ 新增分镜入口
- 前置条件（假设）：已进入分镜管理页，且存在分集上下文
- 操作步骤：点击新增分镜
- 预期结果：新增分镜成功并出现在列表
- 自动化覆盖：AT-NH-003（仅到达页/截图 L0+L1，未覆盖新增）

#### FC-NH-027（3.1.2 编辑分镜入口）
- 功能点：编辑分镜入口（清单截断，详见流程文档）
- 前置条件（假设）：分镜列表存在至少 1 行
- 操作步骤：点击编辑图标/按钮
- 预期结果：进入编辑态或弹窗出现
- 自动化覆盖：暂无

#### FC-NH-028（3.1.3 编辑提示词入口）
- 功能点：编辑提示词入口（清单截断，详见流程文档）
- 前置条件（假设）：分镜列表存在至少 1 行
- 操作步骤：点击编辑提示词
- 预期结果：提示词编辑弹窗/侧栏出现
- 自动化覆盖：暂无

#### FC-NH-029（3.1.4 分镜删除入口）
- 功能点：删除分镜入口（清单截断，详见流程文档）
- 前置条件（假设）：分镜列表存在至少 1 行
- 操作步骤：点击删除
- 预期结果：删除成功（建议二次确认）
- 自动化覆盖：暂无

#### FC-NH-030（3.2.1 剧本输入）
- 功能点：粘贴文本/导入文件
- 前置条件（假设）：分镜管理页存在“AI分析剧本”区域
- 操作步骤：粘贴文本；或选择文件导入
- 预期结果：文本/文件被接受；失败有提示
- 自动化覆盖：暂无

#### FC-NH-031（3.2.2 分析参数：目标时长）
- 功能点：1/3/5/10/30 分钟可选
- 前置条件（假设）：分析参数区存在
- 操作步骤：切换目标时长
- 预期结果：选中态更新
- 自动化覆盖：暂无

#### FC-NH-032（3.2.3 建议分镜数量）
- 功能点：随时长变化的建议分镜数量
- 前置条件（假设）：分析参数可用
- 操作步骤：切换目标时长
- 预期结果：建议值随之变化或给出合理提示
- 自动化覆盖：暂无

#### FC-NH-033（3.2.4 开始分析按钮）
- 功能点：开始分析
- 前置条件（假设）：已有输入文本/文件
- 操作步骤：点击开始分析
- 预期结果：进入分析中状态；完成后有结果
- 自动化覆盖：暂无

#### FC-NH-034（3.2.5 分析产出）
- 功能点：分镜脚本 + 角色/场景抽取
- 前置条件（假设）：分析完成
- 操作步骤：观察结果区
- 预期结果：分镜脚本列表出现；角色/场景抽取可见
- 自动化覆盖：暂无

#### FC-NH-035（3.3.1 提示词生成）
- 功能点：基于分镜脚本生成提示词
- 前置条件（假设）：已有分镜脚本
- 操作步骤：触发提示词生成
- 预期结果：提示词出现在列表列内或生成态可见
- 自动化覆盖：暂无

#### FC-NH-036（3.3.2 提示词展示与编辑）
- 功能点：提示词可见且可编辑
- 前置条件（假设）：列表存在提示词列
- 操作步骤：打开编辑提示词入口
- 预期结果：可编辑并保存
- 自动化覆盖：暂无

### Step 4：分镜绑定（FC-NH-037 ~ FC-NH-038）

#### FC-NH-037（4.1.1 绑定多个角色 ≤3）
- 功能点：分镜行内展示/绑定多个角色标签（≤3）
- 前置条件（假设）：存在角色资产；分镜行可编辑
- 操作步骤：绑定 1~3 个角色；尝试绑定第 4 个
- 预期结果：≤3 成功；第 4 个被阻止或提示
- 自动化覆盖：暂无

#### FC-NH-038（4.1.2 绑定 1 个场景）
- 功能点：分镜行内展示/绑定 1 个场景
- 前置条件（假设）：存在场景资产；分镜行可编辑
- 操作步骤：绑定场景；尝试绑定第二个
- 预期结果：单选生效；第二个需替换或被阻止
- 自动化覆盖：暂无

### Step 5：图片素材（FC-NH-039 ~ FC-NH-041）

#### FC-NH-039（5.1 上传图片）
- 功能点：图片素材上传图片
- 前置条件（假设）：分镜存在素材入口
- 操作步骤：上传图片
- 预期结果：上传成功并出现在素材列表
- 自动化覆盖：暂无（清单缺口：入口/格式/限制未细化）

#### FC-NH-040（5.2 融合生图）
- 功能点：融合生图
- 前置条件（假设）：存在融合参数与触发入口
- 操作步骤：设置参数并生成
- 预期结果：生成成功；失败可解释（提示/重试）
- 自动化覆盖：暂无（清单缺口：参数/入口/结果落位未细化）

#### FC-NH-041（5.3.1 当前/历史 Tabs）
- 功能点：图片管理 Tabs：当前图片 / 历史图片
- 前置条件（假设）：素材区存在 Tabs
- 操作步骤：切换 Tabs
- 预期结果：切换生效且列表内容区分明确
- 自动化覆盖：暂无

### Step 6：视频创作与项目级输出（FC-NH-042 ~ FC-NH-050）

#### FC-NH-042（6.1 进入视频创作）
- 功能点：从分镜进入视频创作
- 前置条件（假设）：存在分镜与对应入口
- 操作步骤：点击进入视频创作
- 预期结果：进入视频创作页且带入正确分镜/素材上下文
- 自动化覆盖：暂无（清单缺口：入口/带参规则未细化）

#### FC-NH-043（6.2.1 制作模式）
- 功能点：图生视频 / 首尾帧视频（互斥）
- 前置条件（假设）：已进入视频创作页
- 操作步骤：切换模式
- 预期结果：互斥生效；表单项随模式变化
- 自动化覆盖：暂无

#### FC-NH-044（6.2.2 模型选择）
- 功能点：模型可选
- 前置条件（假设）：视频创作页模型区存在
- 操作步骤：选择模型
- 预期结果：模型值更新
- 自动化覆盖：暂无

#### FC-NH-045（6.2.3 视频名称）
- 功能点：视频名称输入框
- 前置条件（假设）：视频创作页表单存在
- 操作步骤：输入名称
- 预期结果：名称值更新；必填时有校验
- 自动化覆盖：暂无

#### FC-NH-046（6.2.4 描述）
- 功能点：图生视频描述
- 前置条件（假设）：视频创作页表单存在
- 操作步骤：输入描述
- 预期结果：描述值更新
- 自动化覆盖：暂无

#### FC-NH-047（6.2.5 分辨率）
- 功能点：720P/1080P/2K/4K
- 前置条件（假设）：分辨率可选
- 操作步骤：选择分辨率
- 预期结果：选中态更新
- 自动化覆盖：暂无

#### FC-NH-048（6.2.6 生成数量）
- 功能点：1/2/4/8
- 前置条件（假设）：生成数量可选
- 操作步骤：选择数量
- 预期结果：选中态更新
- 自动化覆盖：暂无

#### FC-NH-049（6.3.1 选择视频片段作为分镜视频）
- 功能点：从生成片段中选择一个作为该分镜结果
- 前置条件（假设）：已生成出多个视频片段
- 操作步骤：选择某片段为“使用/设为”
- 预期结果：分镜的视频结果指向所选片段
- 自动化覆盖：暂无

#### FC-NH-050（6.4.2 导出资源包）
- 功能点：项目级导出资源包
- 前置条件（假设）：存在导出入口且具备导出资源
- 操作步骤：点击导出；等待导出完成
- 预期结果：导出成功（可下载）或失败可解释
- 自动化覆盖：暂无

## 5. 待补齐项（建议优先级）

P0（最影响端到端闭环）：
- FC-NH-012 创建剧本（L3 端到端写入）
- Step 2 分集/角色/场景创建（L3）
- Step 3 新增分镜 + AI分析剧本（L3，可能涉及较长耗时与失败重试）

P1（素材与产出）：
- Step 5 图片素材上传/融合生图（清单缺口需补充入口/限制/结果落位）
- Step 6 视频创作参数/生成/片段选用/导出（清单缺口需补充入口/带参规则）
