# 机器人自动化待办清单（TODO）

> 目标：让 auto-test-bot 在**真实站点**上能够“冷启动”稳定跑通关键业务链路，并把 data-testid 覆盖率/命中率变成可持续的自动化门禁。

## 当前已验证通过（供参考）

- [x] 架构/单元测试：`PYTHONPATH=src pytest -q tests/`（全绿）
- [x] data-testid 集成链路（示例页）：`PYTHONPATH=src python scripts/test_data_testid_integration.py --config config/main_config_with_testid.yaml`（含 CI 门禁通过）

## P0（必须完成）：真实站点“冷成功”闭环

- [ ] 冷启动全链路跑通一次并留证据：`open_site → navigate_to_ai_create → navigate_to_text_image → generate_image → generate_video → validate`
- [ ] 固化主流程运行入口与参数（明确使用的 config、必要的 steps 开关、超时策略）
- [ ] 失败可诊断：失败时最少输出（当前 URL、page_state、关键 action/selector、登录态摘要）

**成功标准**
- [ ] 在无人工干预的前提下，连续多次运行主流程均能达到“冷成功”（至少达到团队约定的稳定阈值）

## P0（必须完成）：登录态与环境前置自动化

- [ ] 登录态生成/刷新流程标准化（生成/更新 `auth_session.json` 或等价机制）
- [ ] 登录态有效性校验前置化（启动即检查 token/user_info 等关键字段，失败早退出）
- [ ] 环境健康检查（目标服务可访问、关键接口可用、必要权限/配额满足）

**成功标准**
- [ ] 任何“因环境/登录态不可用导致的失败”都能在步骤 1~2 内明确失败原因，而不是在后续页面步骤隐式超时

## P0（必须完成）：data-testid 度量/门禁落到主流程

- [ ] 主流程自动落地 `reports/`：保存 testid 命中率/回退率/失败率、元素级统计、缺失契约列表
- [ ] 主流程结束后自动执行门禁校验（等价于 `scripts/validate_testid_coverage.py --report ...`），用退出码/结果决定整体 success
- [ ] 将“required_testids 契约”与“locators 配置真源”形成稳定联动（新增关键交互时必须同步更新）

**成功标准**
- [ ] 门禁失败时，能输出“缺失哪些必需 testid、哪些元素发生 fallback、对应的页面/步骤/策略”并可直接推动前端补齐

## P1（建议完成）：CI 集成与产物管理

- [ ] CI 增加必跑项：`pytest -q tests/`
- [ ] CI 增加门禁项：读取主流程或集成脚本输出的 testid 报告做 gate
- [ ] CI artifacts：上传 `reports/*.json`、`reports/*.html`、关键日志，便于回溯

## P1（建议完成）：“仓库内每个测试用例都可用”

当前现状：直接跑 `PYTHONPATH=src pytest -q` 会额外收集 `scripts/test/` 下的脚本型用例，存在不可运行/不通过的情况。

- [ ] 明确测试集边界：是否将 `scripts/test/` 纳入正式 pytest 测试集
- [ ] 若纳入：统一 async 测试规范（例如 `pytest-asyncio` 标注/配置），修复不符合 pytest 规范的用例（返回非 None、断言契约不一致等）
- [ ] 若不纳入：增加 pytest 配置（如 `pytest.ini`）限定 `testpaths=tests`，避免“一键 pytest”误收集

**成功标准**
- [ ] 团队约定的“一键命令”跑全量测试集全绿，并且用例语义一致、可复现、可维护

## P2（可后置）：文档与协作规范

- [ ] 写清楚“如何冷启动跑主流程 / 如何生成登录态 / 如何看报告 / 门禁失败怎么处理”的单一入口文档
- [ ] 前后端协作：新增关键交互元素时的 `data-testid` 命名与 PR 检查清单固化
- [ ] 周期性复盘：覆盖率趋势、回退原因 TopN、优先补齐路线图

